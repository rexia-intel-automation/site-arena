# Arena BRB - Apache Configuration (ADMIN)

Options -Indexes
AddDefaultCharset UTF-8

# Forçar MIME correto para CSS (quando o arquivo .css é servido como arquivo)
AddType text/css .css

<IfModule mod_headers.c>
    Header set X-Content-Type-Options "nosniff"
    Header set X-Frame-Options "SAMEORIGIN"
    Header set X-XSS-Protection "1; mode=block"
</IfModule>

<IfModule mod_deflate.c>
    AddOutputFilterByType DEFLATE text/html text/plain text/xml text/css text/javascript application/javascript application/json
</IfModule>

<IfModule mod_expires.c>
    ExpiresActive On
    ExpiresByType image/jpg "access plus 1 year"
    ExpiresByType image/jpeg "access plus 1 year"
    ExpiresByType image/gif "access plus 1 year"
    ExpiresByType image/png "access plus 1 year"
    ExpiresByType image/svg+xml "access plus 1 year"
    ExpiresByType text/css "access plus 1 month"
    ExpiresByType application/javascript "access plus 1 month"
    ExpiresByType application/pdf "access plus 1 month"
    ExpiresByType image/x-icon "access plus 1 year"
</IfModule>

<IfModule mod_rewrite.c>
    RewriteEngine On
    RewriteBase /admin/

    # 0) Assets do admin: nunca reescreva/roteie.
    # Se o arquivo existir, Apache serve direto.
    RewriteRule ^assets/ - [L]

    # 0.1) Se pediram /admin/assets/... e NÃO existe arquivo/diretório, devolva 404
    # (Evita cair no index.php e devolver HTML com MIME errado)
    RewriteCond %{REQUEST_URI} ^/admin/assets/ [NC]
    RewriteCond %{REQUEST_FILENAME} !-f
    RewriteCond %{REQUEST_FILENAME} !-d
    RewriteRule ^ - [R=404,L]

    # 1) Remove trailing slash (exceto diretório real)
    RewriteCond %{REQUEST_FILENAME} !-d
    RewriteCond %{REQUEST_URI} (.+)/$
    RewriteRule ^ %1 [R=301,L]

    # 2) Redirect /admin/*.php -> /admin/* (somente quando veio no request original)
    RewriteCond %{THE_REQUEST} \s/+admin/([^\s?]+)\.php[?\s] [NC]
    RewriteRule ^ %1 [R=301,L]

    # 3) Resolve /admin/* -> /admin/*.php quando existir
    RewriteCond %{REQUEST_FILENAME} !-d
    RewriteCond %{REQUEST_FILENAME}.php -f
    RewriteRule ^([^.]+)$ $1.php [L]

    # 4) Fallback do ADMIN (somente quando não é arquivo nem diretório)
    RewriteCond %{REQUEST_FILENAME} !-f
    RewriteCond %{REQUEST_FILENAME} !-d
    RewriteRule ^ index.php [L]
</IfModule>
